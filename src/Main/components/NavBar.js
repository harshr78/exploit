import * as React from 'react';
import PropTypes from 'prop-types';
import AppBar from '@mui/material/AppBar';
import Toolbar from '@mui/material/Toolbar';
import { Container, Typography, Button } from '@mui/material';
import CssBaseline from '@mui/material/CssBaseline';
import useScrollTrigger from '@mui/material/useScrollTrigger';
import Box from '@mui/material/Box';
import ArrowDropDownIcon from '@mui/icons-material/ArrowDropDown';
import Popover from '@mui/material/Popover';
import { styled, alpha } from '@mui/material/styles';
import SearchIcon from '@mui/icons-material/Search';
import InputBase from '@mui/material/InputBase';
import HeaderCard from '../widgets/HeaderCard';
import { Link } from 'react-router-dom';
import ExpandMoreIcon from '@mui/icons-material/ExpandMore';
import IconButton from '@mui/material/IconButton';
import SwipeableDrawer from '@mui/material/SwipeableDrawer';
import List from '@mui/material/List';
import Divider from '@mui/material/Divider';
import ListItem from '@mui/material/ListItem';
import ListItemIcon from '@mui/material/ListItemIcon';
import ListItemText from '@mui/material/ListItemText';
import InboxIcon from '@mui/icons-material/MoveToInbox';
import MailIcon from '@mui/icons-material/Mail';
import MenuIcon from '@mui/icons-material/Menu';
import Accordion from '@mui/material/Accordion';
import AccordionSummary from '@mui/material/AccordionSummary';
import AccordionDetails from '@mui/material/AccordionDetails';
import navbarApi from '../../Core/api/services/navigation';
import logo from '../../Assets/Images/logo-print-hd-transparent-removebg-preview.png';
import PrimaryNavbar from './PrimaryNavbar';
import Services from '../../Data/Service';
import LoginModal from './Login';

const Search = styled('div')(({ theme }) => ({
    position: 'relative',
    borderRadius: theme.shape.borderRadius,
    backgroundColor: alpha(theme.palette.common.white, 0.15),
    '&:hover': {
        backgroundColor: alpha(theme.palette.common.white, 0.25),
    },
    marginRight: theme.spacing(2),
    marginLeft: 0,
    width: '100%',
    [theme.breakpoints.up('sm')]: {
        marginLeft: theme.spacing(3),
        width: 'auto',
    },
}));

const SearchIconWrapper = styled('div')(({ theme }) => ({
    padding: theme.spacing(0, 2),
    height: '100%',
    position: 'absolute',
    pointerEvents: 'none',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
}));

const StyledInputBase = styled(InputBase)(({ theme }) => ({
    color: 'inherit',
    '& .MuiInputBase-input': {
        padding: theme.spacing(1, 1, 1, 0),
        // vertical padding + font size from searchIcon
        paddingLeft: `calc(1em + ${theme.spacing(4)})`,
        transition: theme.transitions.create('width'),
        width: '100%',
        [theme.breakpoints.up('md')]: {
            width: '20ch',
        },
    },
}));


const ExpandMore = styled((props) => {
    const { expand, ...other } = props;
    return <IconButton {...other} />;
})(({ theme, expand }) => ({
    transform: !expand ? 'rotate(0deg)' : 'rotate(180deg)',
    marginLeft: 'auto',
    transition: theme.transitions.create('transform', {
        duration: theme.transitions.duration.shortest,
    }),
}));

const ElevateAppBar = (props) => {
    const [loginOpen, setLoginOpen] = React.useState(false);

    const handleLoginOpen = () => setLoginOpen(true);


    const [anchorEl, setAnchorEl] = React.useState(null);
    const [scroll, setScroll] = React.useState(false);
    const [expanded, setExpanded] = React.useState(false);
    const [navbarData, setNavbarData] = React.useState([]);
    const [currentSection, setCurrentSection] = React.useState(-1);
    const [currentSubSection, setCurrentSubSection] = React.useState(-1);
    const [serviceOpen, setServiceOpen] = React.useState(false);
    const [serviceAnchorEl, setServiceAnchorEl] = React.useState(null);
    const [contactOpen, setContactOpen] = React.useState(false);
    const [contactAnchorEl, setContactAnchorEl] = React.useState(null);
    const [aboutOpen, setAboutOpen] = React.useState(false);
    const [aboutAnchorEl, setAboutAnchorEl] = React.useState(null);
    React.useEffect(() => {
        navbarApi(setNavbarData);

        window.addEventListener("scroll", () => {
            setScroll(window.scrollY > 100);
        });
    }, []);
    const handleExpandClick = () => {
        setExpanded(currentSection != -1);
    };
    const [state, setState] = React.useState({
        top: false,
        left: false,
        bottom: false,
        right: false,
    });

    const toggleDrawer = (anchor, open) => (event) => {

        setState({ ...state, [anchor]: open });
    };

    const list = (anchor) => (
        <Box
            sx={{ width: anchor === 'top' || anchor === 'bottom' ? 'auto' : 250 }}
            role="presentation"
            //   onClick={toggleDrawer(anchor, false)}
            onKeyDown={toggleDrawer(anchor, false)}
        >
            <List>
                <div className="techvanto-sidebar-logo"><img src={`${logo}`} height="100%" width="150px"></img></div>
                <ListItem button>
                    <Accordion className="techvanto-navbar-service-accordian" style={{ boxShadow: "none" }}>
                        <AccordionSummary
                            expandIcon={<ExpandMoreIcon />}
                            aria-controls="panel1a-content"
                            id="panel1a-header"

                        >
                            <Typography>Services</Typography>
                        </AccordionSummary>
                        <AccordionDetails>
                            <List>
                                {Services.map((data, index) => (
                                    <ListItem component={Link} to={data.link} button key={data.text}>
                                        <ListItemText primary={data.text} />
                                    </ListItem>
                                ))}
                            </List>
                        </AccordionDetails>
                    </Accordion>
                </ListItem>
                <ListItem button >

                    <Accordion className="techvanto-navbar-service-accordian" style={{ boxShadow: "none" }}>
                        <AccordionSummary
                            expandIcon={<ExpandMoreIcon />}
                            aria-controls="panel1a-content"
                            id="panel1a-header"

                        >
                            <Typography>Courses</Typography>
                        </AccordionSummary>
                        <AccordionDetails>
                            <List>
                                {Services.map((data, index) => (
                                    <ListItem component={Link} to={data.link} button key={data.text}>
                                        <ListItemText primary={data.text} />
                                    </ListItem>
                                ))}
                            </List>
                        </AccordionDetails>
                    </Accordion>
                </ListItem>
                <ListItem button >

                    <Accordion className="techvanto-navbar-service-accordian" style={{ boxShadow: "none" }}>
                        <AccordionSummary
                            expandIcon={<ExpandMoreIcon />}
                            aria-controls="panel1a-content"
                            id="panel1a-header"

                        >
                            <Typography>About Us</Typography>
                        </AccordionSummary>
                        <AccordionDetails>
                            <List>
                                {Services.map((data, index) => (
                                    <ListItem component={Link} to={data.link} button key={data.text}>
                                        <ListItemText primary={data.text} />
                                    </ListItem>
                                ))}
                            </List>
                        </AccordionDetails>
                    </Accordion>
                </ListItem>
                <ListItem button >

                    <Accordion className="techvanto-navbar-service-accordian" style={{ boxShadow: "none" }}>
                        <AccordionSummary
                            expandIcon={<ExpandMoreIcon />}
                            aria-controls="panel1a-content"
                            id="panel1a-header"

                        >
                            <Typography>Contact Us</Typography>
                        </AccordionSummary>
                        <AccordionDetails>
                            <List>
                                {Services.map((data, index) => (
                                    <ListItem component={Link} to={data.link} button key={data.text}>
                                        <ListItemText primary={data.text} />
                                    </ListItem>
                                ))}
                            </List>
                        </AccordionDetails>
                    </Accordion>
                </ListItem>
                <LoginModal />
            </List>

        </Box>
    );

    const handlePopoverOpen = (event, data) => {
        setCurrentSection(data);
        if (navbarData[data].sectioncategories.length) {
            setCurrentSubSection(0);
        }
        setAnchorEl(event.currentTarget);
        handleExpandClick();
    };
    const handleServiceOpen = (e) => {
        setServiceOpen(true);
        setServiceAnchorEl(e.currentTarget);
    }
    const handleServiceClose = (e) => {
        setServiceOpen(false);
        setServiceAnchorEl(null);
    }
    const handleContactOpen = (e) => {
        setContactOpen(true);
        setContactAnchorEl(e.currentTarget);
    }
    const handleContactClose = (e) => {
        setContactOpen(false);
        setContactAnchorEl(null);
    }
    const handleAboutOpen = (e) => {
        setAboutOpen(true);
        setAboutAnchorEl(e.currentTarget);
    }
    const handleAboutClose = (e) => {
        setAboutOpen(false);
        setAboutAnchorEl(null);
    }
    const handleClose = () => {
        setCurrentSection(-1);
        setCurrentSubSection(-1);
        setAnchorEl(null);
        handleExpandClick();
    };

    const open = Boolean(anchorEl);
    const id = open ? 'techvanto-course-popover' : undefined;

    return (
        <React.Fragment>
            <CssBaseline />

            <AppBar className={scroll ? "navbar-background" : "bg-royal-transparent"} >
                <div className={scroll?"display-none":""}>
                    <PrimaryNavbar></PrimaryNavbar>
                </div>
                <Container maxWidth="lg" className="techvanto-navbar-mobile">
                    <React.Fragment key={'right'} >
                        <Button onClick={toggleDrawer('right', true)} className="techvanto-navbar-menu-icon">
                            <IconButton
                                size="large"
                                edge="start"
                                color="inherit"
                                aria-label="menu"
                                sx={{ mr: 2 }}
                                padding="0px"
                            >
                                <MenuIcon />
                            </IconButton>
                        </Button>
                        <SwipeableDrawer
                            anchor={'right'}
                            open={state['right']}
                            onClose={toggleDrawer('right', false)}
                            onOpen={toggleDrawer('right', true)}
                        >
                            {list('right')}
                        </SwipeableDrawer>
                    </React.Fragment>
                    <Container maxWidth="lg" style={{ display: "flex", justifyContent: "center" }} >
                        <img src={`${logo}`} height="100%" width="150px"></img>

                    </Container>
                </Container>
                <Container maxWidth="lg" className="techvanto-navbar-web">
                    <Toolbar>

                        <img src={`${logo}`} height="100%" width="150px"></img>



                        <Container maxWidth="md" sx={{ a: 2 }} style={{
                            display: "flex", alignItems: "center", width: "61%"
                        }}>
                            <Typography variant="a" component="div" onMouseLeave={handleServiceClose} style={{ marginRight: "10px" }} onMouseEnter={handleServiceOpen}>
                                <a className={scroll ? "techvanto-nabar-link " : "navbar-text-color-white"}>
                                    Services<ExpandMore
                                        expand={Boolean(serviceAnchorEl)}
                                        aria-expanded={Boolean(serviceAnchorEl)}
                                        aria-label="show more"
                                    >
                                        <ExpandMoreIcon sx={scroll == false ? { color: "white" } : {}} />
                                    </ExpandMore>
                                </a>

                                <Popover
                                    id={id}
                                    open={Boolean(serviceAnchorEl)}
                                    anchorEl={serviceAnchorEl}
                                    anchorOrigin={{
                                        vertical: 'bottom',
                                    }}
                                    transformOrigin={{
                                        vertical: 'top',
                                        horizontal: 'center',
                                    }}
                                    className="technovanto-scroll-hide techvanto-navbar-popover"

                                >

                                    <Typography onMouseLeave={handleServiceClose} component="div" sx={{ a: 2 }} className="technovanto-scroll-hide">

                                        <div className="technovanto-navbar-dropdown-content-left technovanto-scroll-hide" style={{ width: "100%" }}>
                                            <List>
                                                {Services.map((data, index) => (
                                                    <ListItem component={Link} to={data.link} button key={data.text}>
                                                        <ListItemText primary={data.text} />
                                                    </ListItem>
                                                ))}
                                            </List>
                                        </div>
                                    </Typography>
                                </Popover>
                            </Typography>

                            <div style={{ display: "flex" }}  >
                                {
                                    navbarData.map((data, index) => {
                                        return (
                                            <Typography onMouseLeave={handleClose} variant="a" component="div"
                                                onMouseEnter={(e) => { handlePopoverOpen(e, index) }}

                                                aria-describedby={index}
                                            >
                                                <a className={scroll ? "techvanto-nabar-link " : "navbar-text-color-white"}>
                                                    {data.title}
                                                    <ExpandMore
                                                        expand={currentSection == index}
                                                        aria-expanded={currentSection == index}
                                                        aria-label="show more"
                                                    >
                                                        <ExpandMoreIcon sx={scroll == false ? { color: "white" } : {}} />
                                                    </ExpandMore>
                                                </a>

                                                <Popover
                                                    id={id}
                                                    open={open}
                                                    anchorEl={anchorEl}
                                                    anchorOrigin={{
                                                        vertical: 'bottom',
                                                        horizontal: 'right',
                                                    }}
                                                    transformOrigin={{
                                                        vertical: 'top',
                                                        horizontal: 'center',
                                                    }}
                                                    className="technovanto-scroll-hide techvanto-navbar-popover"

                                                >

                                                    <Typography onMouseLeave={handleClose} component="div" sx={{ a: 2 }} className="technovanto-scroll-hide">

                                                        <div className="technovanto-navbar-dropdown-content technovanto-scroll-hide">
                                                            <div className="technovanto-navbar-dropdown-content-left technovanto-scroll-hide">
                                                                <ul className="techvanto-list technovanto-scroll-hide">
                                                                    <li className="techvanto-list-header technovanto-scroll-hide">
                                                                        Course Category:
                                                                    </li>
                                                                    {

                                                                        currentSection != -1 ? navbarData[currentSection].sectioncategories.map((sectionData, index) => {
                                                                            return <li className="" onMouseEnter={() => { setCurrentSubSection(index) }}>
                                                                                {sectionData.title}
                                                                            </li>
                                                                        }) : ""
                                                                    }



                                                                </ul>
                                                            </div>

                                                            <div className="technovanto-navbar-dropdown-content-right technovanto-scroll-hide">
                                                                <div className="technovanto-dropdown-right-card technovanto-scroll-hide">
                                                                    {currentSection != -1 && currentSubSection != -1 ?
                                                                        <HeaderCard
                                                                            image={navbarData[currentSection].sectioncategories[currentSubSection].pic}
                                                                            description={navbarData[currentSection].sectioncategories[currentSubSection].description}
                                                                            title={navbarData[currentSection].sectioncategories[currentSubSection].title}
                                                                            gradient={navbarData[currentSection].sectioncategories[currentSubSection].gradient}
                                                                        >
                                                                        </HeaderCard> : ""

                                                                    }

                                                                </div>

                                                                <div className="technovanto-dropdown-right-link technovanto-scroll-hide">
                                                                    <ul className="techvanto-list technovanto-scroll-hide">
                                                                        <li className="techvanto-list-header technovanto-scroll-hide">
                                                                            Select Category:
                                                                        </li>
                                                                        {currentSection != -1 && currentSubSection != -1 ? navbarData[currentSection].sectioncategories[currentSubSection].sectionsubcategories.map((data, index) => {
                                                                            console.log("/" + data.title + "/" + data.id);
                                                                            return (

                                                                                <li className="active">
                                                                                    <Link to={"/" + data.title + "/" + data.id}>{data.title}</Link>
                                                                                </li>);
                                                                        }) : ""}
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </Typography>
                                                </Popover>
                                            </Typography>
                                        )
                                    })}


                            </div>
                            <Typography variant="a" component="div" onMouseLeave={handleAboutClose} style={{ marginRight: "10px" }} onMouseEnter={handleAboutOpen}>
                                <a className={scroll ? "techvanto-nabar-link " : "navbar-text-color-white"}>
                                    About Us<ExpandMore
                                        expand={Boolean(aboutAnchorEl)}
                                        aria-expanded={Boolean(aboutAnchorEl)}
                                        aria-label="show more"
                                    >
                                        <ExpandMoreIcon sx={scroll == false ? { color: "white" } : {}} />
                                    </ExpandMore>
                                </a>

                                <Popover
                                    id={id}
                                    open={Boolean(aboutAnchorEl)}
                                    anchorEl={aboutAnchorEl}
                                    anchorOrigin={{
                                        vertical: 'bottom',
                                    }}
                                    transformOrigin={{
                                        vertical: 'top',
                                        horizontal: 'center',
                                    }}
                                    className="technovanto-scroll-hide techvanto-navbar-popover"

                                >

                                    <Typography onMouseLeave={handleAboutClose} component="div" sx={{ a: 2 }} className="technovanto-scroll-hide">

                                        <div className="technovanto-navbar-dropdown-content-left technovanto-scroll-hide" style={{ width: "100%" }}>
                                            <List>
                                                {Services.map((data, index) => (
                                                    <ListItem component={Link} to={data.link} button key={data.text}>
                                                        <ListItemText primary={data.text} />
                                                    </ListItem>
                                                ))}
                                            </List>
                                        </div>
                                    </Typography>
                                </Popover>
                            </Typography>

                            <Typography variant="a" component="div" onMouseLeave={handleContactClose} style={{ marginRight: "10px" }} onMouseEnter={handleContactOpen}>
                                <a className={scroll ? "techvanto-nabar-link " : "navbar-text-color-white"}>
                                    Contact Us<ExpandMore
                                        expand={Boolean(contactAnchorEl)}
                                        aria-expanded={Boolean(contactAnchorEl)}
                                        aria-label="show more"
                                    >
                                        <ExpandMoreIcon sx={scroll == false ? { color: "white" } : {}} />
                                    </ExpandMore>
                                </a>

                                <Popover
                                    id={id}
                                    open={Boolean(contactAnchorEl)}
                                    anchorEl={contactAnchorEl}
                                    anchorOrigin={{
                                        vertical: 'bottom',
                                    }}
                                    transformOrigin={{
                                        vertical: 'top',
                                        horizontal: 'center',
                                    }}
                                    className="technovanto-scroll-hide techvanto-navbar-popover"

                                >

                                    <Typography onMouseLeave={handleContactClose} component="div" sx={{ a: 2 }} className="technovanto-scroll-hide">

                                        <div className="technovanto-navbar-dropdown-content-left technovanto-scroll-hide" style={{ width: "100%" }}>
                                            <List>
                                                {Services.map((data, index) => (
                                                    <ListItem component={Link} to={data.link} button key={data.text}>
                                                        <ListItemText primary={data.text} />
                                                    </ListItem>
                                                ))}
                                            </List>
                                        </div>
                                    </Typography>
                                </Popover>
                            </Typography>



                        </Container>
                        {/* <Button variant="contained" className="techvanto-know-more-button ">Login / Signup</Button> */}
                        <LoginModal />

                    </Toolbar>
                </Container>
            </AppBar>

        </React.Fragment>

    );
}

export default ElevateAppBar;