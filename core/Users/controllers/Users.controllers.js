const db = require("../../Connection/index.models")
const bcrypt = require('bcrypt');

let usermodel = db.User;

function validPassword(password,hash) {
    return bcrypt.compareSync(password, hash);
}
exports.authenticateUserWithphone = (user) => {
    return new Promise((resolve, reject) => {
        try {
            usermodel.findOne({
                where: {
                    phone: user.phone // user email
                }
            }).then(async (response) => {
                if (!response) {
                    resolve(false);
                } else {
                    if (!response.dataValues.password ||
                        !await validPassword(user.password.toString(),
                            response.dataValues.password)) {
                        resolve(false);
                    } else {
                        resolve(response.dataValues)
                    }
                }
            })
        } catch (error) {
            const response = {
                status: 500,
                data: {},
                error: {
                    message: "user match failed"
                }
            };
            reject(response);
        }
    })
}
