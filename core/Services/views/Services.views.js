const express = require("express");
var router = express.Router();
var sectionTypeController = require("../controllers/SectionType.controllers");
var serviceRoutes = require("../routes/Service.routes");
var categoryController = require("../controllers/SectionCategory.controllers");
var subCategoryController = require("../controllers/SectionSubCategory.controllers");
var serviceController = require("../controllers/Service.controllers");
var curriculumController = require("../controllers/Curriculam.controllers");
const { service, curriculum } = require("../../Connection/index.models");



router.get(serviceRoutes.GetServiceTypes, async (req,res)=>{
    var types;
    await sectionTypeController.findAll().then(data=>{
        types=data;
    }).catch(ex=>{
        types=[];
    })

    return res.send(types);
    
});

router.get(serviceRoutes.AllServices,async(req,res)=>{
    var subCategory;
    var services;
    var condition = null;
    await subCategoryController.findAll().then(data=>{
        subCategory = data;
    }).catch(ex=>{
        subCategory=[]
    })
    if(req.query.id){
        condition={sectionsubcategoryId:req.query.id.split(",")}
    }
    await serviceController.findAll(condition).then(data=>{
        services = data;
    }).catch(ex=>{
        console.log(ex);
        services=[]
    })
    return res.send({"services":services,"subcategory":subCategory});
})

router.get(serviceRoutes.GetService,(req,res)=>{
    var condition={id:req.query.id};
    serviceController.findOne(condition,res)

})

router.get(serviceRoutes.GetCurriculum,async (req,res)=>{
    var curriculum;
    var serviceId = req.query.id;
    if(!serviceId){
        res.statusCode=406;
        return res.send("please select service")
    }
    var condition = {serviceId:serviceId}
    await curriculumController.findAll(condition).then(data=>
        {
            curriculum=data;
        }).catch(ex=>{
            curriculum=[]
        })
        return res.send(curriculum);
})

router.post(serviceRoutes.UploadServiceTypes,(req,res,next)=>{
    if(!req.body.title){
        res.statusCode=400;
        return res.send("please fill all the details");
    }
    else{
       serviceController.create(req.body.title,res)
    }
})
module.exports = router;